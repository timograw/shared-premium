<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../bower_components/iron-cookie/iron-cookie.html">

<link rel="import" href="../../bower_components/paper-styles/typography.html">

<link rel="import" href="../shared-premium-logo/shared-premium-logo-big.html">

<link rel="import" href="../sp-style/sp-style.html">
<link rel="import" href="../shared-premium-login-dialog/shared-premium-login-dialog.html">

<dom-module id="shared-premium-splash">
    <template>

        <style include="sp-style">
            #splash {
                position: absolute;
                top: 0px;
                bottom: 0px;
                left: 0px;
                right: 0px;
                z-index: 100;
                background-color: var(--primary);
            }

            .window-centered {
                position: fixed;

                top: 50%;
                left: 50%;
                /* bring your own prefixes */
                transform: translate(-50%, -50%);
                text-align: center;
            }

            .centered {
                display: inline-block;
            }

            .main-title {
                @apply --paper-font-display2;
                color: #fff;
            }

            shared-premium-login-dialog {
                margin-top: 50px;
            }

            #splash.hidden {
                visibility: hidden;
                opacity: 0;
                background-color: rgba(0, 0, 0, 0);
                -webkit-transition: background-color 250ms linear, visibility 0s 500ms, opacity 500ms linear, transform 500ms;
                -ms-transition: background-color 250ms linear, visibility 0s 500ms, opacity 500ms linear, transform 500ms;
                transition: background-color 250ms linear, visibility 0s 500ms, opacity 500ms linear;
            }

            #splash.hidden .centered {
                transform: scale(3);
                transition:  transform 500ms;
            }
        </style>

        <iron-cookie name="sessionid" value="{{sessionid}}" id="sessionIdCookie"></iron-cookie>

        <iron-ajax url="/api/session" 
                   method="GET"
                   content-type="application/json"
                   handle-as="json"
                   on-response="handleSessionResponse"
                   id="sessionRequest"
                   last-response="{{session}}"
                   last-error="{{error}}"></iron-ajax>

        <div id="splash">
            <div class="window-centered">
                <div class="main-title">Shared Premium</div>
                <div class="centered">
                    <shared-premium-logo-big></shared-premium-logo-big>
                </div>
                <shared-premium-login-dialog id="loginform" session="{{session}}" hidden="[[sessionid]]"></shared-premium-login-dialog>

            </div>
        </div>
    </template>

    <script>
        /**
     * @customElement
     * @polymer
     */
        class SharedPremiumSplash extends Polymer.Element {
            static get is() { return 'shared-premium-splash'; }
            static get properties() {
                return {
                    session: {
                        type: Object,
                        notify: true,
                        observer: '_sessionChanged'
                    },
                    sessionid: {
                        type: String,
                        notify: true,
                        observer: '_sessionidChanged'
                    },
                    loginHidden: {
                        type: Boolean
                    }
                };
            }

            ready() {
                super.ready();
                this.$.sessionIdCookie.getCookie();
                console.log((this.sessionid));
                if (this.sessionid) {
                    this.$.sessionRequest.generateRequest();
                } else {

                }
            }

            _sessionidChanged(newValue, oldValue) {
                console.log('new'+newValue);
            }

            _sessionChanged(newValue, oldValue) {
                if (newValue) {
                    this.$.splash.classList.add('hidden');
                }
            }
        }


        window.customElements.define(SharedPremiumSplash.is, SharedPremiumSplash);
    </script>

</dom-module>